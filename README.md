*使用说明*

*SUPPER 2018-11-11*

**N****etPlot软件使用说明**

![img](file:////tmp/wps-delvis/ksohtml/wpsZ5dFko.png)

# 1 **引言**

## **1****.1 编写目的**

X软件是X系统中不可缺少的一部分，它能够实时的解析下位机传输过来采样数据及发送控制命令。上位机采用网络传输通信的Tcp Socket通信，且上位机作为Client端模式。FPGA端（下位机）应配置Tcp Socket通信的服务器端模式，绑定IP后，由上位机请求接入，建立稳定连接后进行数据通信。

## **1****.2** **项目背景**

	Client端配置：

![img](file:////tmp/wps-delvis/ksohtml/wpsOdC3Iy.jpg) 

 

Local ip：为运行该上位机的机器的IP，软件启动后自动检测并填写，无需用户查找填写；

Server Ip：为服务器端的IP地址；

Port Num：为服务器端设定的端口号码；

**当用户点击Connect按钮，该Client端会向服务器端提交建立连接请求。**

## 1.3  **定义**

**为了更好适配上位机软件运行**，本上位机软件提供建立TCP Socket Server端的Python示例，请按照该功能对FPGA端（下位机）进行配置，**文件名称：socketserver.py**	**Python版本： 2.7.14**

脚本内容：

\# python Server

 

import  time

import	socket

import  math

 

## 1.4  **参考资料**

 

 

# 2 **软件概述**

## **2****.1 目标**

通过建立XXX系统软件实现对数字信号的实时接收、低延迟实时显示、数字信号的频谱实时分析、信号数据的存储管理、及对下位机的相关参数进行配置。通过XXX系统软件可以直观的观测记录信号，有效地为科研实验提供硬件平台。

## **2****.2 功能**

\* 4通道数据7*24小时实时记录数据功能，将数据按照时间命名并存入数据。

\* 4通道同步实时时域信号绘图功能。

\* 4 通道同步实时频域信号绘图功能。

\* 向下位机写入命令控制字的功能，配置下位机相关参数，例如：低通滤波器频率、前放信号板的二级增益大小等。

\* 网络管理功能，对以太网设定进行管理，可以随时关停/开启以太网连接。

\* 接收屏蔽功能，关闭系统接收数据的功能。

 

 

## **2****.3** **性能**

#### **a) 以太网性能**

以太网传输速度3.3MB/s

B) **磁盘写入速度**
磁盘以3.3MB/s的稳定IO速度。

C) **RAM内存占用**

如下表所示：

**表1-1 开启不同功能RAM空间大小**

| **开启存储功能** | **开启4通道时域绘图** | **开启4通道频域绘图** | **RAM空间** |
| ---------------- | --------------------- | --------------------- | ----------- |
| ×                | ×                     | ×                     | 9MB         |
| √                | ×                     | ×                     | 15MB        |
| √                | √                     | ×                     | 17MB        |
| √                | √                     | √                     | 19MB        |

 

D) **ROM内存占用**

76MB空间

  

# 3 **运行环境**

## **3.1 硬件**

l CPU 最低要求1.7 GHz 双核 处理器

l 推荐2 GHz 双核处理器及以上

l 内存 最低要求RAM 2GB可用空间 1666MHz主频（包含系统）

l 推荐 4GB内存 1666MHz及以上

l 硬盘 最低要求25GB 系统及软件空间

l 推荐1T以上硬盘（系统最低要求25GB闪存空间）及以上可用空间

l 网卡 使用100M网卡J45接口

l 推荐1000M网卡J45接口

l 显示 VGA( 800x600)或更高分辨率的显示器（低于1080P）颜色为32位真彩色

l 鼠标及键盘 通用USB外置键盘和鼠标设备

## **3.2 操作系统要求**

l Linux系列系统：Ubuntu 14.04 Alpha版本以上 低于Ubuntu 18.04.1 beta版本以下 （Linux内核要求4.1.x版本） 64位系统（不支持32位系统）

l Windows系统： Windows 7 / Windows 8 / Windows 8.1 / Windows 10 （不支持Windows XP  Windows 2000系统、 Windows Vista、Windows Server版本） 32位及64位系统

# 4 **使用说明**

如图所示为软件启动后的界面，该界面分为5大区域，分别是：

l 网络配置区域

l 控制信息配置区域

l 时域图形绘制区域

l 频域图形绘制区域

l 已存储信息文件列表

![img](file:////tmp/wps-delvis/ksohtml/wpsxIUF7I.jpg) 

 

## **4.1 网络配置区域**

下位机同上位机依靠以太网进行数据传输，应用层以太网遵循TCP/IP协议，为了能够使上位机和下位机的数据交互，则需要按照TCP/IP协议中的规定进行配置。本软件作为TCP/IP中的Client端接入连接。

l **本地IP**

软件运行之后，会自动读取本机的网卡信息，得到本机IP数据。

l **服务端IP**

为下位机的IP，可以手动修改该IP，默认IP已经给出，除非更换下位机设备才进行修改。

l **端口号**

默认已经给出，不需要修改。

l **连接按钮**

待下位机上电之后，需要大概5s的启动时间，5s启动成功以后，通过点击连接就可以同下位机进	行连接，如果连接成功，会有对话框提示连接已经建立。连接建立之后所有需要依靠以太网才能运	行的功能按钮，就会从灰化状态跳变为尚亮状态，随之连接按钮灰化不可以操作。如果点击连接后	软件弹出对话框提示建立连接失败，则需要检查下位机上电状态和网线是否连接牢固。

l **断开连接**

在关闭软件之前，请点击断开连接，以切断和下位机数据的以太网连接。

l **开启接收**

	**系统运行后默认是使能接收的，当按下开启接收后系统会关闭接收功能，但保持接入以太网且可以**	**向下位机发送控制命令；当再次按下开启接收按钮之后，系统会使能接收功能。**

l **打开存储功能**

	**系统运行后默认是关闭存储功能的，当点击开启存储功能的时候，系统开启存储功能，开始读取系**	**统时间并以时间进行命名创建文件，向文件写入数据；再次点击该按钮时系统会停止向硬盘写入数**	**据，在下次开启存储时，会跳过上次的文件，重新创建数据文件。**

## **4.2 控制信息配置区域**

**控制信息配置能够向下位机写入配置信息，这里包含低通滤波器截止频率配置（单位KHz）、采样频率暂时不能配置、一级和二级增益信息配置、系统提示信息显示。**

l **低通滤波器截止频率（单位KHz）配置：范围**

l **一级增益配置：范围（1-100） 当输入超过范围的数据系统就会弹出警告窗口。**

l **二级增益配置：范围（1-50）当输入超过范围的数据系统就会弹出警告窗口。**

l **系统信息显示窗口： 系统会提示一些必要的运行信息，比如：建立新的文件、创建文件的时间戳、系统的网络状态等。**

## **4.3 时域图像绘制**

时域图像绘制使用QWT专业绘图组件进行制作。QWT即Qt Widgets for Technical Applications，是一个基于LGPL版权协议的开源项目， 可生成各种统计图，是为具有技术专业背景的程序提供GUI组件和一组实用类，其目标是以基于2D方式的窗体部件来显示数据， 数据源以数值，数组或一组浮点数等方式提供， 输出方式可以是Curves（曲线），Slider（滚动条），Dials（圆盘），Compasses（仪表盘）等等。QWT工具库是基于Qt开发的，继承了Qt的跨平台特性。

本软件能够进行四个通道数据同时的绘制，通过checkedBox进行勾选以显示某个通道的数据。如图1-1软件界面第3部分，勾选通道显示，相反，取消勾选则屏蔽该通道显示。在同时显示多个通道数据的同时，绘图区域会以不同颜色进行显示，并自动适配纵坐标以完全显示所有通道波形。

## **4.4 时域图像绘制**

频域显示是对时域信号进行傅里叶变换得到的图像，其中经过优化的傅里叶变换算法是基于FFTW组件，它是一组共享和分布式存储系统，且能够自动适应机器、缓存、存储器大小目前比任何开源Fourier变换都要快，FFTW编码生成器采用面向对象语言Caml编写。

与时域显示相同，通过checkedBox组件进行勾选以显示某个通道的频域数据，且支持多通道同步显示，使用不同颜色标注出来。

## **4.5 文件显示区域**

当开启存储功能的情况下，软件会自动对数据进行管理，并根据时间和数据量大小对文件进行创建，创建的文件会以系统时间命名，文件创建之后会在文件显示区域显示文件名字和实时显示文件的存储进度。

# 5 **使用流程图**

 